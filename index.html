<script>
// ====== Barèmes (1 très défavorable → 20 très bénéfique) ======
const PROFILES = {
  LEGUMES_FRAIS:        [19,18,19,20,20,20],
  LEGUMES_FECULENTS:    [12,11,12,12,12,12],
  FRUITS_ENTIERS:       [17,16,17,16,18,18],
  LEGUMINEUSES:         [18,16,17,17,19,19],
  CEREALES_COMPLETES:   [15,12,14,15,16,16],
  CEREALES_RAFFINEES:   [10,9,10,9,11,12],
  OLEAGINEUX_GRAINES:   [16,18,16,13,16,16],
  POISSONS_GRAS:        [18,19,18,17,18,18],
  POISSONS_MAIGRES:     [16,15,16,16,17,17],
  FRUITS_DE_MER:        [15,14,15,15,16,16],
  VOLAILLE_BLANCHE:     [13,12,13,14,14,14],
  VIANDE_ROUGE:         [8, 8, 9, 12,10,10],
  CHARCUTERIE:          [4, 5, 6, 10,6, 6],
  FROMAGES_GRAS:        [7, 9, 9, 11,10, 9],
  LAITAGES_ECREMES:     [13,12,13,13,13,13],
  LAITS_VEGETAUX_NS:    [14,12,13,13,14,14],
  HUILE_OLIVE:          [17,18,17,17,18,18],
  HUILE_COLZA_NOIX_LIN: [18,18,18,17,18,18],
  HUILES_SAT_TRANS:     [5, 6, 5, 10,7, 8],
  SUCRES_AJOUTES:       [5, 5, 4, 5, 7,12],
  BOISSONS_SUCREES:     [4, 5, 3, 4, 6,12],
  BOISSONS_LIGHT_EDULCO:[11,10,11,12,11,11], // sodas “zero/light” (sans sucre)
  ALCOOL_MODERE:        [9,11, 8, 9, 6, 9],
  ALCOOL_FORT:          [6, 7, 5, 7, 4, 8],
  FRITURE_SALEE:        [6, 7, 6, 9, 7, 6],
  SAUCES_SALEES_SODIUM: [10,10,10,12,11, 6],
  SAUCES_GRASSES_SUCRE: [7, 7, 6, 9, 8, 9],
  CHOCOLAT_NOIR_70:     [12,13,11,11,11,12],
};

// ====== Normalisation ======
const norm = s => s
  .toLowerCase()
  .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
  .replace(/’/g,"'").replace(/[\.\(\)]/g,' ')
  .replace(/\s+/g,' ').trim();

// ====== Listes d'aliments étendues ======
const LISTES = {
  POISSONS_GRAS: ['saumon','truite','sardines','maquereau','hareng','anchois','thon rouge','anguille'],
  POISSONS_MAIGRES: ['cabillaud','colin','merlu','lieu','haddock','carrelet','sole','tilapia','perche','brochet','morue'],
  FRUITS_DE_MER: ['crevettes','gambas','langoustines','moules','coques','palourdes','huitres','huîtres','calamar','poulpe','crabe','tourteau','homard'],
  VOLAILLE_BLANCHE: ['poulet','blanc de poulet','dinde','blanc de dinde','escalope de poulet','poulet roti','poulet rôti'],
  VIANDE_ROUGE: ['boeuf','bœuf','steak','entrecote','entrecôte','faux filet','rumsteck','joue de boeuf','agneau','cotelette agneau','mouton','veau','porc','cote de porc','côte de porc'],
  CHARCUTERIE: ['jambon','jambon cru','jambon blanc','saucisson','chorizo','salami','bacon','lard','pancetta','coppa','rosette','andouille','andouillette','rillettes','pâté','pate en croute','knack','saucisse','merguez','chipolata','mortadelle','boudin noir'],
  FROMAGES_GRAS: ['camembert','brie','coulommiers','chaource','reblochon','munster','epoisses','époisses','roquefort','bleu','fourme d ambert','comte','comté','emmental','gouda','cheddar','raclette','tomme','parmesan','mozzarella','feta','fêta','buche de chevre','bûche de chèvre','chevre','chèvre'],
  LAITAGES_ECREMES: ['yaourt 0%','yaourt nature','skyr','fromage blanc 0%','cottage cheese','petit suisse 0%','lait ecreme','lait demi ecreme'],
  LAITS_VEGETAUX_NS: ['lait de soja non sucre','lait d amande non sucre','lait d avoine non sucre','boisson vegetale non sucree','boisson végétale non sucrée'],
  HUILE_OLIVE: ['huile d olive','olive huile'],
  HUILE_COLZA_NOIX_LIN: ['huile de colza','huile de noix','huile de lin','huile de pepins de raisin','huile de pépins de raisin'],
  HUILES_SAT_TRANS: ['beurre','beurre clarifie','ghee','huile de palme','huile de coco','margarine hydrogenee','graisse de canard','saindoux'],
  OLEAGINEUX_GRAINES: ['noix','noix de pecan','noix de macadamia','amandes','noisettes','pistaches','noix de cajou','cacahuetes','cacahuètes','beurre de cacahuete sans sucre','graines de tournesol','graines de courge','graines de lin','graines de sesame','graines de sésame','tahini'],
  LEGUMES_FRAIS: ['salade','laitue','roquette','mache','mâche','epinards','épinards','blettes','chou','chou kale','chou rouge','chou fleur','chou-fleur','brocoli','haricots verts','courgette','aubergine','poivron','tomate','concombre','radis','carotte','fenouil','celeri branche','céleri branche','oignon','ail','champignons','asperges','endives','navet','betterave cuite','courge','butternut','potimarron','artichaut'],
  LEGUMES_FECULENTS: ['pomme de terre vapeur','pomme de terre','patate douce','mais','maïs','petits pois','igname','manioc'],
  FRUITS_ENTIERS: ['pomme','poire','banane','orange','mandarine','clementine','clémentine','citron','pamplemousse','raisin','fraise','framboise','myrtille','mûre','mure','cerise','abricot','peche','pêche','nectarine','prune','kiwi','mangue','ananas','papaye','grenade','figue','dattes'],
  LEGUMINEUSES: ['lentilles','pois chiches','pois casses','pois cassés','haricots rouges','haricots blancs','haricots noirs','flageolets','soja edamame','edamame','feves','fèves'],
  CEREALES_COMPLETES: ['pain complet','pain au levain integral','pain au levain intégral','pain seigle','pain sarrasin','pain aux cereales','riz complet','riz brun','quinoa','pates completes','pâtes complètes','pates semi completes','boulgour complet','orge','millet','flocons d avoine','son d avoine','muesli sans sucre'],
  CEREALES_RAFFINEES: ['pain blanc','baguette','pain de mie','biscotte','riz blanc','pates','pâtes','semoule','couscous','polenta','tortilla ble','wrap','galette de riz','crepes farine blanche','crêpes farine blanche','viennoiserie nature'],
  SUCRES_AJOUTES: ['sucre','cassonade','sirop','miel','confiture','pate a tartiner','pâte à tartiner','chocolat au lait','barre chocolatée','bonbons','biscuits','patisserie','pâtisserie','croissant','pain au chocolat','brioche sucree','brioche sucrée','gaufre sucree','pancakes sirop','glace','dessert lacte sucre','dessert lacté sucré'],
  BOISSONS_SUCREES: ['soda','cola','coca','pepsi','orangina','oasis','limonade','ice tea sucre','thé glacé sucré','boisson energetique','boisson énergétique','red bull','monster','jus d orange','jus d\'orange','jus de pomme','jus de fruits','nectar','smoothie sucre','smoothie sucré'],
  BOISSONS_LIGHT_EDULCO: ['coca zero','coca zéro','coca light','pepsi max','ice tea zero','thé glacé zéro','red bull sugarfree','boisson 0% sucre','soda zero','soda zéro','orangina zero','oasis zero'],
  ALCOOL_MODERE: ['biere','bière','vin','cidre','spritz','aperol spritz'],
  ALCOOL_FORT: ['whisky','vodka','rhum','gin','tequila','liqueur','pastis','cognac'],
  FRITURE_SALEE: ['frites','patatas bravas','beignets sales','beignets salés','nuggets','cordon bleu','escalope panee','escalope panée','poisson pane','poisson pané','tempura','onion rings','chips','tacos frits'],
  SAUCES_SALEES_SODIUM: ['sauce soja','tamari','maggi','nuoc mam','nuoc-mam','anchovy sauce','pate miso','pâte miso','bouillon cube','cornichons','olives salees','olives salées'],
  SAUCES_GRASSES_SUCRE: ['mayonnaise','sauce bearnaise','béarnaise','hollandaise','aioli','aïoli','sauce barbecue','bbq','ketchup','sauce cocktail','andalouse','samourai','samouraï','biggy burger','vinaigrette toute prete','vinaigrette toute prête'],
  CHOCOLAT_NOIR_70: ['chocolat noir 70%','chocolat noir','cacao 100%'],

  // === Marques & produits courants (FR) ===
  SUCRES_AJOUTES_plus: [
    'nutella','kinder bueno','kinder maxi','kinder country','bn','granola lu','prince lu','oreo','pepito','pépito','petit beurre','petit écolier',
    'danette','danonino','yop','actimel','crème dessert','maltesers','twix','snickers','mars','lion','bounty','haribo','skittles',
    'nesquik','cereales chocapic','céréales chocapic','chocapic','golden grahams','frosties','smacks','miel pops',
    'magnum','haagen dazs','häagen dazs','haagen-dazs','ben and jerry'
  ],
  BOISSONS_SUCREES_plus: [
    'oasis tropical','oasis pomme cassis framboise','orangina rouge','fanta','sprite','schweppes agrum','schweppes tonic','icetea peach','liptonic'
  ],
  BOISSONS_LIGHT_EDULCO_plus: [
    'coca zero cherry','coca zero caffeine free','pepsi max cherry','schweppes zero','fanta zero','sprite zero'
  ],

  // === Plats/brasserie & restauration rapide (classés par “dominante”) ===
  FRITURE_SALEE_plus: ['steak frites','moules frites','fish and chips','calamar frit','beignets de poulet','fondu de camembert frit'],
  FROMAGES_GRAS_plus: ['croque monsieur','croque-monsieur','tartiflette','raclette','fondue savoyarde','pizza','pizza 4 fromages','pizza quatre fromages','pizza royale','gratin dauphinois','cordon bleu (plat)'],
  CHARCUTERIE_plus: ['kebab sauce blanche','assiette charcuterie','planche charcuterie'],
  SAUCES_GRASSES_SUCRE_plus: ['salade cesar','salade césar','caesar salad','burger sauce','wrap sauce blanche'],
  CEREALES_RAFFINEES_plus: ['burger','big mac','whopper','tacos','panini','baguette sandwich','croissant jambon fromage','pates carbo','pâtes carbo','pates bolognaise','pâtes bolognaise','sushi','makis','poke bowl riz blanc'],
  CEREALES_COMPLETES_plus: ['buddha bowl','poke bowl quinoa','salade quinoa','bol avoine','porridge avoine'],
  VOLAILLE_BLANCHE_plus: ['tikka poulet (sans sauce)','poulet grillé simple'],
  VIANDE_ROUGE_plus: ['tartare de boeuf','entrecote grillée','entrecôte grillée']
};

// Intégration des “_plus”
LISTES.SUCRES_AJOUTES.push(...(LISTES.SUCRES_AJOUTES_plus||[]));
LISTES.BOISSONS_SUCREES.push(...(LISTES.BOISSONS_SUCREES_plus||[]));
LISTES.BOISSONS_LIGHT_EDULCO.push(...(LISTES.BOISSONS_LIGHT_EDULCO_plus||[]));
LISTES.FRITURE_SALEE.push(...(LISTES.FRITURE_SALEE_plus||[]));
LISTES.FROMAGES_GRAS.push(...(LISTES.FROMAGES_GRAS_plus||[]));
LISTES.CHARCUTERIE.push(...(LISTES.CHARCUTERIE_plus||[]));
LISTES.SAUCES_GRASSES_SUCRE.push(...(LISTES.SAUCES_GRASSES_SUCRE_plus||[]));
LISTES.CEREALES_RAFFINEES.push(...(LISTES.CEREALES_RAFFINEES_plus||[]));
LISTES.CEREALES_COMPLETES.push(...(LISTES.CEREALES_COMPLETES_plus||[]));
LISTES.VOLAILLE_BLANCHE.push(...(LISTES.VOLAILLE_BLANCHE_plus||[]));
LISTES.VIANDE_ROUGE.push(...(LISTES.VIANDE_ROUGE_plus||[]));
['SUCRES_AJOUTES_plus','BOISSONS_SUCREES_plus','BOISSONS_LIGHT_EDULCO_plus','FRITURE_SALEE_plus','FROMAGES_GRAS_plus','CHARCUTERIE_plus','SAUCES_GRASSES_SUCRE_plus','CEREALES_RAFFINEES_plus','CEREALES_COMPLETES_plus','VOLAILLE_BLANCHE_plus','VIANDE_ROUGE_plus'].forEach(k=>delete LISTES[k]);

// ====== Dictionnaire construit ======
function makeDict(def){
  const map={};
  for(const [cat,arr] of Object.entries(def)){
    for(const item of arr) map[norm(item)]=cat;
  }
  return map;
}
const DICT = makeDict(LISTES);

// ====== Fallbacks sémantiques (sécurité) ======
const KEYWORD_FALLBACKS = [
  {kw:['legume','crudite','salade','roquette','epinard','brocoli','chou','carotte','courgette','poivron','tomate'], cat:'LEGUMES_FRAIS'},
  {kw:['patate','pomme de terre','mais','petits pois','patate douce'], cat:'LEGUMES_FECULENTS'},
  {kw:['fruit','pomme','poire','banane','framboise','fraise','raisin','agrumes','orange'], cat:'FRUITS_ENTIERS'},
  {kw:['lentille','pois chiche','haricot','flageolet','edamame','feve'], cat:'LEGUMINEUSES'},
  {kw:['complet','levain','seigle','sarrasin','avoine','quinoa','orge','riz brun'], cat:'CEREALES_COMPLETES'},
  {kw:['pain','baguette','riz blanc','pates','semoule','couscous','tortilla','polenta','galette'], cat:'CEREALES_RAFFINEES'},
  {kw:['noix','amande','noisette','pistache','cacahuete','graines'], cat:'OLEAGINEUX_GRAINES'},
  {kw:['saumon','sardine','maquereau','hareng','truite'], cat:'POISSONS_GRAS'},
  {kw:['cabillaud','colin','merlu','sole','tilapia','morue'], cat:'POISSONS_MAIGRES'},
  {kw:['crevette','moule','huitre','calamar','poulpe'], cat:'FRUITS_DE_MER'},
  {kw:['poulet','dinde','volaille'], cat:'VOLAILLE_BLANCHE'},
  {kw:['boeuf','porc','agneau','veau','steak','entrecote'], cat:'VIANDE_ROUGE'},
  {kw:['jambon','saucisson','bacon','lard','chorizo','charcuterie'], cat:'CHARCUTERIE'},
  {kw:['fromage','raclette','tartiflette','pizza','quiche','croque'], cat:'FROMAGES_GRAS'},
  {kw:['yaourt','skyr','fromage blanc','lait ecreme'], cat:'LAITAGES_ECREMES'},
  {kw:['soja non sucre','amande non sucre','avoine non sucre','boisson vegetale'], cat:'LAITS_VEGETAUX_NS'},
  {kw:['huile olive'], cat:'HUILE_OLIVE'},
  {kw:['huile colza','huile noix','huile lin','pepins de raisin'], cat:'HUILE_COLZA_NOIX_LIN'},
  {kw:['beurre','palme','coco','margarine'], cat:'HUILES_SAT_TRANS'},
  {kw:['sucre','confiture','patisserie','biscuit','chocolat au lait','bonbon','tartiner','nutella','kinder','oreo','bn','prince'], cat:'SUCRES_AJOUTES'},
  {kw:['soda','cola','oasis','orangina','fanta','sprite','jus','nectar','energy drink','the glace'], cat:'BOISSONS_SUCREES'},
  {kw:['zero','light','sans sucre','sugarfree','max'], cat:'BOISSONS_LIGHT_EDULCO'},
  {kw:['biere','vin','cidre','spritz'], cat:'ALCOOL_MODERE'},
  {kw:['whisky','vodka','rhum','gin','tequila','liqueur','pastis'], cat:'ALCOOL_FORT'},
  {kw:['frites','pane','nuggets','beignet','chips','tempura','onion rings'], cat:'FRITURE_SALEE'},
  {kw:['soja sauce','tamari','bouillon','maggi','nuoc mam'], cat:'SAUCES_SALEES_SODIUM'},
  {kw:['mayonnaise','bbq','ketchup','bearnaise','hollandaise','aioli','cesar'], cat:'SAUCES_GRASSES_SUCRE'},
  {kw:['chocolat noir'], cat:'CHOCOLAT_NOIR_70'},
  {kw:['sushi','maki','poke bowl'], cat:'CEREALES_RAFFINEES'}
];

// ====== Classif robuste ======
function classify(raw){
  const t = norm(raw);
  if(!t) return null;
  if(DICT[t]) return DICT[t];
  for(const key in DICT){ if(t.includes(key)) return DICT[key]; }
  for(const rule of KEYWORD_FALLBACKS){
    for(const w of rule.kw){ if(t.includes(norm(w))) return rule.cat; }
  }
  return null;
}
<<script>
// === Ajout de plats précis ===
LISTES.LEGUMINEUSES.push('cassoulet');
LISTES.CEREALES_RAFFINEES.push(
  'couscous','paella','risotto','galette complete','galette complète',
  'bo bun','pho','pad thai','pizza margherita','lasagnes'
);
LISTES.CHARCUTERIE.push('choucroute garnie','pizza pepperoni','quiche lorraine');
LISTES.FROMAGES_GRAS.push('raclette complete','raclette complète','tartiflette','fondue savoyarde','gratin dauphinois');
LISTES.VIANDE_ROUGE.push('blanquette de veau','boeuf bourguignon');
LISTES.CEREALES_COMPLETES.push('bibimbap');
</script>/script>
