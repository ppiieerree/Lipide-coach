<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lipido-Coach — v2 (propre)</title>
<style>
  :root{--fg:#111;--bg:#fff;--muted:#6b7280;--primary:#2563eb;}
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,sans-serif;margin:0;background:#f7f7f8;color:var(--fg);}
  header{padding:20px;border-bottom:1px solid #e5e7eb;background:#fff;position:sticky;top:0;z-index:1}
  h1{margin:0;font-size:1.25rem}
  main{max-width:960px;margin:0 auto;padding:18px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:14px;margin:10px 0}
  label{display:block;margin:.4rem 0 .2rem;font-weight:600}
  textarea{width:100%;min-height:96px;padding:10px;border:1px solid #d1d5db;border-radius:10px;font-size:1rem;background:#fff}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end}
  .row>*{flex:1 1 320px}
  button{background:var(--primary);color:#fff;border:none;border-radius:10px;padding:12px 14px;font-weight:600;cursor:pointer}
  button:disabled{opacity:.5;cursor:not-allowed}
  .help{color:var(--muted);font-size:.9rem}
  table{border-collapse:collapse;width:100%}
  th,td{border:1px solid #e5e7eb;padding:8px;text-align:center}
  th{background:#f3f4f6;position:sticky;top:0;z-index:0}
  td.aliment,th.aliment{text-align:left}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:.8rem;border:1px solid #e5e7eb;color:#374151;background:#fff;margin-left:6px}
  .score{font-variant-numeric:tabular-nums}
  .s20{background:#ecfdf5} .s15{background:#f0fdf4} .s10{background:#fff7ed} .s5{background:#fef2f2} .s1{background:#fee2e2}
  .advice-list{margin:8px 0 0 18px}
  footer{color:#6b7280;font-size:.85rem;padding:24px;text-align:center}
</style>
</head>
<body>
<header>
  <h1>Lipido-Coach <span class="pill">v2</span></h1>
  <div class="help">Colle ton menu (ex : <i>saumon, riz complet, courgettes, huile d’olive</i>). Échelle 1→20 : 20 = très bénéfique pour le paramètre ciblé, 1 = très défavorable.</div>
</header>

<main>
  <section class="card">
    <div class="row">
      <div>
        <label for="repas">Ton repas</label>
        <textarea id="repas" placeholder="Sépare par virgule, point-virgule, retour à la ligne, ‘et’, ‘/’ ou ‘+’.&#10;Ex : omelette, pain complet et avocat / tomate + huile d’olive"></textarea>
        <div class="help">Raccourci : <kbd>Ctrl</kbd>/<kbd>⌘</kbd> + <kbd>Entrée</kbd> pour analyser.</div>
      </div>
      <div style="max-width:240px">
        <button id="analyser">Analyser</button>
        <div class="help" style="margin-top:8px">Conseils générés automatiquement en dessous du tableau.</div>
      </div>
    </div>
  </section>

  <section id="resultats" class="card" style="display:none">
    <h2>Notes par aliment</h2>
    <div style="overflow:auto;max-height:55vh;margin-top:8px">
      <table id="tableau">
        <thead>
          <tr>
            <th class="aliment">Aliment</th>
            <th>LDL</th><th>HDL</th><th>Triglyc.</th><th>Glycémie</th><th>Stéatose</th><th>HTA</th>
            <th>Score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="synthese" class="card" style="display:none">
    <h2>Résumé & conseils</h2>
    <div id="resume" class="help" style="margin-bottom:6px"></div>
    <ul id="conseils" class="advice-list"></ul>
  </section>
</main>

<footer>© 2025 — Lipido-Coach v2. Fichier statique, aucune transmission réseau.</footer>

<script>
/* --- Profils (1=très défavorable → 20=très bénéfique) : [LDL, HDL, TG, Gly, Steatose, HTA] --- */
const PROFILES = {
  LEGUMES_FRAIS:[19,18,19,20,20,20], FRUITS_ENTIERS:[17,16,17,16,18,18], LEGUMINEUSES:[18,16,17,17,19,19],
  CEREALES_COMPLETES:[15,12,14,15,16,16], OLEAGINEUX:[16,18,16,13,16,16],
  POISSONS_GRAS:[18,19,18,17,18,18], POISSONS_MAIGRES:[16,15,16,16,17,17],
  VOLAILLE_BLANCHE:[13,12,13,14,14,14], VIANDE_ROUGE:[8,8,9,12,10,10], CHARCUTERIE:[4,5,6,10,6,6],
  FROMAGES_GRAS:[7,9,9,11,10,9], HUILE_OLIVE:[17,18,17,17,18,18], HUILE_COLZA_NOIX:[18,18,18,17,18,18],
  HUILE_SAT_TRANS:[5,6,5,10,7,8], PRODUITS_LAITIERS_ECR:[13,12,13,13,13,13],
  SUCRES_AJOUTES:[5,5,4,5,7,12], BOISSON_SUCRE:[4,5,3,4,6,12], ALCOOL_MODERE:[9,11,8,9,6,9],
  ALCOOL_FORT:[6,7,5,7,4,8], FRITURE_SALEE:[6,7,6,9,7,6], PAIN_BLANC_PATES:[10,9,10,9,11,12],
  SUBSTITUTS_VEG_PROT:[15,14,15,14,15,15],
};
/* Dictionnaire d’aliments courants → catégories */
const DICT = {
  "saumon":"POISSONS_GRAS","maquereau":"POISSONS_GRAS","sardines":"POISSONS_GRAS","thon":"POISSONS_MAIGRES",
  "cabillaud":"POISSONS_MAIGRES","colin":"POISSONS_MAIGRES","poulet":"VOLAILLE_BLANCHE","dinde":"VOLAILLE_BLANCHE",
  "steak":"VIANDE_ROUGE","boeuf":"VIANDE_ROUGE","agneau":"VIANDE_ROUGE","porc":"VIANDE_ROUGE",
  "jambon":"CHARCUTERIE","saucisson":"CHARCUTERIE","bacon":"CHARCUTERIE","chorizo":"CHARCUTERIE","salami":"CHARCUTERIE",
  "fromage":"FROMAGES_GRAS","parmesan":"FROMAGES_GRAS","cheddar":"FROMAGES_GRAS","camembert":"FROMAGES_GRAS",
  "yaourt 0%":"PRODUITS_LAITIERS_ECR","yaourt nature":"PRODUITS_LAITIERS_ECR","skyr":"PRODUITS_LAITIERS_ECR","cottage":"PRODUITS_LAITIERS_ECR",
  "huile d’olive":"HUILE_OLIVE","huile d'olive":"HUILE_OLIVE","huile de colza":"HUILE_COLZA_NOIX","huile de noix":"HUILE_COLZA_NOIX",
  "beurre":"HUILE_SAT_TRANS","margarine hydrogénée":"HUILE_SAT_TRANS",
  "avocat":"OLEAGINEUX","noix":"OLEAGINEUX","amandes":"OLEAGINEUX","noisettes":"OLEAGINEUX","pistaches":"OLEAGINEUX","noix de cajou":"OLEAGINEUX",
  "lentilles":"LEGUMINEUSES","pois chiches":"LEGUMINEUSES","haricots rouges":"LEGUMINEUSES",
  "quinoa":"CEREALES_COMPLETES","riz complet":"CEREALES_COMPLETES","riz brun":"CEREALES_COMPLETES",
  "riz blanc":"PAIN_BLANC_PATES","pâtes complètes":"CEREALES_COMPLETES","pâtes":"PAIN_BLANC_PATES",
  "pain complet":"CEREALES_COMPLETES","pain":"PAIN_BLANC_PATES","flocons d’avoine":"CEREALES_COMPLETES","flocons d'avoine":"CEREALES_COMPLETES",
  "pizza":"FROMAGES_GRAS","frites":"FRITURE_SALEE","mayonnaise":"HUILE_SAT_TRANS","ketchup":"SUCRES_AJOUTES","miel":"SUCRES_AJOUTES",
  "confiture":"SUCRES_AJOUTES","pâtisserie":"SUCRES_AJOUTES","soda":"BOISSON_SUCRE","coca":"BOISSON_SUCRE","jus d’orange":"BOISSON_SUCRE","jus d'orange":"BOISSON_SUCRE",
  "bière":"ALCOOL_MODERE","vin":"ALCOOL_MODERE","whisky":"ALCOOL_FORT","vodka":"ALCOOL_FORT","chips":"FRITURE_SALEE",
  "tomate":"LEGUMES_FRAIS","courgette":"LEGUMES_FRAIS","brocoli":"LEGUMES_FRAIS","salade":"LEGUMES_FRAIS","épinards":"LEGUMES_FRAIS","epinards":"LEGUMES_FRAIS","carottes":"LEGUMES_FRAIS",
  "pomme":"FRUITS_ENTIERS","banane":"FRUITS_ENTIERS","poire":"FRUITS_ENTIERS","orange":"FRUITS_ENTIERS",
  "pois gourmands":"LEGUMES_FRAIS","tofu":"SUBSTITUTS_VEG_PROT","tempeh":"SUBSTITUTS_VEG_PROT","seitan":"SUBSTITUTS_VEG_PROT"
};
/* Fallback par mots-clés si non trouvé */
const KEYWORD_FALLBACKS=[
  {kw:["légume","salade","crudité","crudites","tomate","concombre","courgette","brocoli","carotte","épinard","epinard"],cat:"LEGUMES_FRAIS"},
  {kw:["fruit","pomme","poire","banane","orange","baie","framboise","fraise","raisin"],cat:"FRUITS_ENTIERS"},
  {kw:["lentille","pois chiche","haricot"],cat:"LEGUMINEUSES"},
  {kw:["complet","quinoa","avoine","son","seigle","épeautre","epautre","sarrasin","riz brun"],cat:"CEREALES_COMPLETES"},
  {kw:["pain","riz","pâtes","pates","semoule","blanc"],cat:"PAIN_BLANC_PATES"},
  {kw:["saumon","maquereau","sardine"],cat:"POISSONS_GRAS"},
  {kw:["cabillaud","colin","merlu","lieu"],cat:"POISSONS_MAIGRES"},
  {kw:["poulet","dinde","volaille"],cat:"VOLAILLE_BLANCHE"},
  {kw:["boeuf","agneau","veau","porc","steak","entrecôte","entrecote"],cat:"VIANDE_ROUGE"},
  {kw:["jambon","saucisson","bacon","charcuterie","chorizo","salami"],cat:"CHARCUTERIE"},
  {kw:["fromage","brie","emmental","cheddar","roquefort","raclette"],cat:"FROMAGES_GRAS"},
  {kw:["huile d'olive","huile d’olive","olive"],cat:"HUILE_OLIVE"},
  {kw:["huile de colza","colza","noix"],cat:"HUILE_COLZA_NOIX"},
  {kw:["beurre","crème","mayonnaise","margarine"],cat:"HUILE_SAT_TRANS"},
  {kw:["yaourt","skyr","cottage","fromage blanc"],cat:"PRODUITS_LAITIERS_ECR"},
  {kw:["sucre","pâtisserie","gateau","gâteau","chocolat au lait","bonbon","sirop"],cat:"SUCRES_AJOUTES"},
  {kw:["soda","cola","boisson sucrée","jus"],cat:"BOISSON_SUCRE"},
  {kw:["bière","vin"],cat:"ALCOOL_MODERE"},
  {kw:["whisky","vodka","rhum","gin"],cat:"ALCOOL_FORT"},
  {kw:["frite","chips","beignet","pané","pane"],cat:"FRITURE_SALEE"},
  {kw:["tofu","tempeh","seitan"],cat:"SUBSTITUTS_VEG_PROT"}
];

function quantityModifier(t){
  t=t.toLowerCase(); let f=1.0;
  if(/\b(300|400|500)\s?g\b/.test(t) || /\b(grandes?|double)\b/.test(t)) f-=0.05;
  if(/\b(2|3|4)\s?(bières|bieres|verres|tranches|cuillères|cuilleres|c\.?à\.?s?)\b/.test(t)) f-=0.05;
  if(/\b(petite|50\s?g|100\s?g|1\s?c\.?à?\.?s?)\b/.test(t)) f+=0.03;
  return Math.max(0.9, Math.min(1.05, f));
}
function classify(raw){
  const item=raw.trim().toLowerCase();
  if(!item) return null;
  if(DICT[item]) return DICT[item];
  for(const k in DICT){ if(item.includes(k)) return DICT[k]; }
  for(const r of KEYWORD_FALLBACKS){ for(const w of r.kw){ if(item.includes(w)) return r.cat; } }
  return null;
}
function colorClass(v){ if(v>=17)return"s20"; if(v>=13)return"s15"; if(v>=9)return"s10"; if(v>=5)return"s5"; return"s1"; }
function mean(a){ return a.reduce((x,y)=>x+y,0)/a.length; }
function splitItems(txt){ return txt.replace(/\bet\b/gi, ",").split(/[,;\n\/\+]+/).map(s=>s.trim()).filter(Boolean); }

function analyse(){
  const txt=document.getElementById('repas').value;
  const parts=splitItems(txt);
  const tbody=document.querySelector('#tableau tbody'); tbody.innerHTML="";
  const rows=[];
  for(const p of parts){
    const cat=classify(p);
    const profile=cat?PROFILES[cat]:[10,10,10,10,10,10];
    const qmod=quantityModifier(p);
    const scored=profile.map(v=>Math.max(1,Math.min(20,Math.round(v*qmod))));
    const avg=Math.round(mean(scored)*10)/10;
    rows.push({aliment:p,cat,scored,avg});
  }
  if(rows.length===0){
    document.getElementById('resultats').style.display="none";
    document.getElementById('synthese').style.display="none";
    return;
  }
  for(const r of rows){
    const tr=document.createElement('tr');
    const td0=document.createElement('td'); td0.className="aliment"; td0.textContent=r.aliment+" ";
    const tag=document.createElement('span'); tag.className="pill"; tag.textContent=(r.cat?r.cat.replaceAll("_"," ").toLowerCase():"catégorie inconnue");
    td0.appendChild(tag); tr.appendChild(td0);
    ["LDL","HDL","TG","Gly","Stéatose","HTA"].forEach((_,i)=>{
      const td=document.createElement('td'); td.className="score "+colorClass(r.scored[i]); td.textContent=r.scored[i]; tr.appendChild(td);
    });
    const tdAvg=document.createElement('td'); tdAvg.className="score "+colorClass(Math.round(r.avg)); tdAvg.textContent=r.avg.toFixed(1); tr.appendChild(tdAvg);
    tbody.appendChild(tr);
  }
  document.getElementById('resultats').style.display="block";
  const globalAvg=Math.round(mean(rows.map(r=>r.avg))*10)/10;
  document.getElementById('resume').innerHTML=`Score moyen global : <b>${globalAvg.toFixed(1)}/20</b> — ${globalAvg>=15?"très favorable":(globalAvg>=12?"plutôt correct":"à améliorer")}.`;
  const conseils=document.getElementById('conseils'); conseils.innerHTML="";
  const lowLDL=rows.filter(r=>r.scored[0]<=9), lowHDL=rows.filter(r=>r.scored[1]<=9), highTG=rows.filter(r=>r.scored[2]<=9), highGly=rows.filter(r=>r.scored[3]<=9), stea=rows.filter(r=>r.scored[4]<=9), hta=rows.filter(r=>r.scored[5]<=9);
  function li(t){ const el=document.createElement('li'); el.innerHTML=t; conseils.appendChild(el); }
  if(lowLDL.length) li(`LDL : réduire/remplacer ${lowLDL.map(r=>"<b>"+r.aliment+"</b>").join(", ")} → +fibres (légumes, légumineuses) et huiles d’olive/colza.`);
  if(lowHDL.length) li(`HDL : +poissons gras, huile d’olive/noix. Limiter ${lowHDL.map(r=>"<b>"+r.aliment+"</b>").join(", ")}.`);
  if(highTG.length)  li(`Triglycérides : attention aux sucres/gras. Réduire ${highTG.map(r=>"<b>"+r.aliment+"</b>").join(", ")}.`);
  if(highGly.length) li(`Glycémie : privilégier céréales complètes/légumineuses. Diminuer ${highGly.map(r=>"<b>"+r.aliment+"</b>").join(", ")}.`);
  if(stea.length)    li(`Stéatose : limiter sucres/alcool et fritures : ${stea.map(r=>"<b>"+r.aliment+"</b>").join(", ")}.`);
  if(hta.length)     li(`Hypertension : réduire sel/ultra-transformés, sauces et charcuteries : ${hta.map(r=>"<b>"+r.aliment+"</b>").join(", ")}.`);
  if(conseils.children.length===0){ li("Rien d’alarme ici. Rester sur : légumes majoritaires, protéine maigre/poisson, céréales complètes, huiles riches en acides gras insaturés."); }
}
document.getElementById('analyser').addEventListener('click', analyse);
document.getElementById('repas').addEventListener('keydown',(e)=>{ if((e.ctrlKey||e.metaKey)&&e.key==='Enter'){ e.preventDefault(); analyse(); }});
// Démo automatique à l’ouverture
document.getElementById('repas').value="saumon, riz complet et courgettes / huile d’olive";
analyse();
</script>
</body>
</html>
